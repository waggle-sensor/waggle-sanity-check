#!/bin/bash

echo "RPi Connection Test: Begin"

expectedRPi=$(cat /etc/waggle/node_manifest.json | jq '[.shield | select(.present == true)] | length')

if [[ $expectedRPi == 0 ]]; then
    echo "RPi Present Test: No shield expected for this device PASS"
    exit 0
fi

if ping -q -c 1 -W 1 10.31.81.4 >/dev/null; then
    echo "RPi Connection Test: Ping of 10.31.81.4 successful PASS"
    exit 0
fi

echo "RPi Connection Test: couldn't ping 10.31.81.4 FAIL"
exit 1
